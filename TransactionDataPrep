/* IMPORT, COMBINE, AND CLEAN DATA FROM QB */

PROC IMPORT OUT= WORK.JMS_SALES_2019 DATAFILE= "/folders/myfolders/sasuser.v94/JMS Analysis/SalesByCustomerDetail2019.CSV" 
            DBMS=csv REPLACE;
     GETNAMES=YES;
     GUESSINGROWS=MAX;
RUN;

PROC IMPORT OUT= WORK.JMS_SALES_2020 DATAFILE= "/folders/myfolders/sasuser.v94/JMS Analysis/SalesByCustomerDetail2020.CSV" 
            DBMS=csv REPLACE;
     GETNAMES=YES;
     GUESSINGROWS=MAX;
RUN;
	

PROC SQL;
	CREATE TABLE JMS_QB_SALES AS SELECT
	VAR1
	,TYPE 
	,DATE 
	,NUM 
	,MEMO 
	,NAME 
	,ITEM 
	,QTY 
	,SALES_PRICE 
	,AMOUNT 
	,BALANCE

	FROM JMS_SALES_2019
	WHERE TYPE IS NOT NULL
	
	UNION
	
	SELECT 
	VAR1
	,TYPE 
	,DATE 
	,NUM 
	,MEMO 
	,NAME 
	,ITEM 
	,QTY 
	,SALES_PRICE 
	,INPUT(AMOUNT, BEST12.) 
	,BALANCE

	FROM JMS_SALES_2020
	WHERE TYPE IS NOT NULL
	
	;QUIT;


/* Group dates into months and perform initital cleaning/transformation */

PROC SQL;
	CREATE TABLE JMS_TRANS_2019_2020 AS SELECT
	TYPE
	,CASE WHEN DATE LIKE ('%2019%') THEN '2019'
		WHEN DATE LIKE ('%2020%') THEN '2020'
		ELSE 'OTHER' END AS YEAR
	,CASE WHEN DATE LIKE ('01%') AND DATE LIKE '%2019' THEN 01012019
	WHEN DATE LIKE ('02%') AND DATE LIKE '%2019' THEN 02022019
	WHEN DATE LIKE ('03%') AND DATE LIKE '%2019' THEN 03032019
	WHEN DATE LIKE ('04%') AND DATE LIKE '%2019' THEN 04042019
	WHEN DATE LIKE ('05%') AND DATE LIKE '%2019' THEN 05052019
	WHEN DATE LIKE ('06%') AND DATE LIKE '%2019' THEN 06062019
	WHEN DATE LIKE ('07%') AND DATE LIKE '%2019' THEN 07072019
	WHEN DATE LIKE ('08%') AND DATE LIKE '%2019' THEN 08082019
	WHEN DATE LIKE ('09%') AND DATE LIKE '%2019' THEN 09092019
	WHEN DATE LIKE ('10%') AND DATE LIKE '%2019' THEN 10102019
	WHEN DATE LIKE ('11%') AND DATE LIKE '%2019' THEN 11112019
	WHEN DATE LIKE ('12%') AND DATE LIKE '%2019' THEN 12122019
	WHEN DATE LIKE ('01%') AND DATE LIKE '%2020' THEN 13012020
	WHEN DATE LIKE ('02%') AND DATE LIKE '%2020' THEN 14022020
	WHEN DATE LIKE ('03%') AND DATE LIKE '%2020' THEN 15032020
	WHEN DATE LIKE ('04%') AND DATE LIKE '%2020' THEN 16042020
	WHEN DATE LIKE ('05%') AND DATE LIKE '%2020' THEN 17052020
	WHEN DATE LIKE ('06%') AND DATE LIKE '%2020' THEN 18062020
	WHEN DATE LIKE ('07%') AND DATE LIKE '%2020' THEN 19072020
	WHEN DATE LIKE ('08%') AND DATE LIKE '%2020' THEN 20082020
	WHEN DATE LIKE ('09%') AND DATE LIKE '%2020' THEN 21092020
	WHEN DATE LIKE ('10%') AND DATE LIKE '%2020' THEN 21102020
	WHEN DATE LIKE ('11%') AND DATE LIKE '%2020' THEN 23112020
	WHEN DATE LIKE ('12%') AND DATE LIKE '%2020' THEN 24122020
		ELSE 0 END AS MONTH_YEAR
	,DATE
	,NUM
	,UPCASE(MEMO) AS PROD_DESC
	,CASE WHEN UPCASE(NAME) LIKE ('JMSPRODUCTSUSA WEBSITE') THEN 'RETAIL'
	WHEN UPCASE(NAME) LIKE ('AMAZON.COM') THEN 'RETAIL'
	WHEN UPCASE(NAME) LIKE ('EBAY - WORLDWIDE') THEN 'RETAIL'
	WHEN UPCASE(NAME) LIKE ('ETSY SALES') THEN 'RETAIL'
		ELSE 'WHOLESALE' END AS CHANNEL
	,UPCASE (NAME) AS CUST_NAME
	,UPCASE (ITEM) AS ITEM_CODE
	,INPUT(QTY, BEST.) AS QTY
	,INPUT(SALES_PRICE, BEST.) AS SALES_PRICE
	,AMOUNT AS ITEM_TOTAL
	,INPUT(BALANCE, BEST.) AS CUM_TOTAL
	
	FROM JMS_QB_SALES
	
	WHERE TYPE IS NOT NULL
	
	;QUIT;
	
	
/* 	CREATE TABLE THAT IS ORDERS ONLY */
	
PROC SQL;
	CREATE TABLE ORDERS_ONLY AS SELECT
	*
	FROM JMS_TRANS_2019_2020
	WHERE ITEM_CODE NOT LIKE ('%FREIGHT%')
		AND PROD_DESC NOT LIKE ('%DROP SHIP%')
		
	;QUIT;


PROC SQL;
	CREATE TABLE WHOLESALE_BY_MONTH AS SELECT
	MONTH_YEAR
	,CHANNEL
	,COUNT(DISTINCT NUM) AS TOTAL_ORDERS
	,SUM(ITEM_TOTAL) AS SALES_TOTAL
	
	FROM ORDERS_ONLY
	
	WHERE CHANNEL IN ('WHOLESALE')
	
	GROUP BY 1,2
	ORDER BY 1
	
	;QUIT;
	
	
/* REVIEW MONTHLY SALES BY CHANNEL */
	
PROC SQL;
	CREATE TABLE RETAIL_BY_MONTH AS SELECT
	MONTH_YEAR
	,CHANNEL
	,COUNT(DISTINCT NUM) AS TOTAL_ORDERS
	,SUM(ITEM_TOTAL) AS SALES_TOTAL
	
	FROM ORDERS_ONLY
	
	WHERE CHANNEL IN ('RETAIL')
	
	GROUP BY 1,2
	ORDER BY 1
	
	;QUIT;


/* PROC EXPORT DATA=WORK.ORDERS_ONLY */
/* OUTFILE='/folders/myfolders/sasuser.v94/JMS Analysis/ORDERS_ONLY.csv' */
/* DBMS=CSV */
/* REPLACE; */
/* RUN; */


PROC SQL;
	CREATE TABLE REVIEW_ORDERS AS SELECT
	*
	FROM ORDERS_ONLY
	WHERE NUM IN ('15875')
	
	;QUIT;
	
PROC SQL;
	CREATE TABLE ORDER_TOTALS_FROM_INV AS SELECT
	CHANNEL
	,SUM(ITEM_TOTAL)
	FROM ORDERS_ONLY
	GROUP BY 1
	;QUIT;
	
	
/* CREATE BASE FOR TRANSACTION DATASET AND TRANSPOSE DATA*/

PROC SQL;
	CREATE TABLE JMS_TRANS AS SELECT
	NUM
	,ITEM_CODE
	,CHANNEL
	,CASE WHEN ITEM_CODE IS NOT NULL THEN 1 ELSE 0
		END AS ITEMS
	FROM ORDERS_ONLY
	WHERE TYPE IN ('Invoice')
	
	;QUIT;
	
PROC SQL;
	CREATE TABLE JMS_TRANS1 AS SELECT
	DISTINCT ITEM_CODE
	,NUM
	,ITEMS
	FROM JMS_TRANS
	;QUIT;
	
	
PROC SORT DATA=JMS_TRANS1 OUT=SORTED_JMS_TRANS;
	BY NUM ITEM_CODE;
	RUN;
	
PROC TRANSPOSE DATA=SORTED_JMS_TRANS OUT=TRANSACTION_DATA_JMS;
	BY NUM;
	ID ITEM_CODE;
/* 	VAR ITEMS; */
	RUN;
	
/* PROC EXPORT DATA=WORK.JMS_TRANS */
/* OUTFILE='/folders/myfolders/sasuser.v94/JMS Analysis/JMSTRANS2.csv' */
/* DBMS=CSV */
/* REPLACE; */
/* RUN; */

PROC SQL;
	CREATE TABLE JMS_TRANS_WS AS SELECT
	DISTINCT ITEM_CODE
	,NUM
	,ITEMS
	FROM JMS_TRANS
	WHERE CHANNEL IN ('WHOLESALE')
	;QUIT;
	
	
PROC SORT DATA=JMS_TRANS_WS OUT=SORTED_JMS_TRANS_WS;
	BY NUM ITEM_CODE;
	RUN;
	
PROC TRANSPOSE DATA=SORTED_JMS_TRANS_WS OUT=WS_TRANS_DATA_JMS;
	BY NUM;
	ID ITEM_CODE;
/* 	VAR ITEMS; */
	RUN;
	
/* PROC EXPORT DATA=WORK.WS_TRANS_DATA_JMS */
/* OUTFILE='/folders/myfolders/sasuser.v94/JMS Analysis/JMS_WS_TRANS.csv' */
/* DBMS=CSV */
/* REPLACE; */
/* RUN; */


PROC SQL;
	CREATE TABLE JMS_TRANS_RET AS SELECT
	DISTINCT ITEM_CODE
	,NUM
	,ITEMS
	FROM JMS_TRANS
	WHERE CHANNEL IN ('RETAIL')
	;QUIT;
	
	
PROC SORT DATA=JMS_TRANS_RET OUT=SORTED_JMS_TRANS_RET;
	BY NUM ITEM_CODE;
	RUN;
	
PROC TRANSPOSE DATA=SORTED_JMS_TRANS_RET OUT=RET_TRANS_DATA_JMS;
	BY NUM;
	ID ITEM_CODE;
/* 	VAR ITEMS; */
	RUN;
	
PROC EXPORT DATA=WORK.RET_TRANS_DATA_JMS
OUTFILE='/folders/myfolders/sasuser.v94/JMS Analysis/JMS_RET_TRANS.csv'
DBMS=CSV
REPLACE;
RUN;

/* IMPORT, COMBINE, AND CLEAN DATA FROM QB */

PROC IMPORT OUT= WORK.JMS_SALES_2019 DATAFILE= "/folders/myfolders/sasuser.v94/JMS Analysis/SalesByCustomerDetail2019.CSV" 
            DBMS=csv REPLACE;
     GETNAMES=YES;
     GUESSINGROWS=MAX;
RUN;

PROC IMPORT OUT= WORK.JMS_SALES_2020 DATAFILE= "/folders/myfolders/sasuser.v94/JMS Analysis/SalesByCustomerDetail2020.CSV" 
            DBMS=csv REPLACE;
     GETNAMES=YES;
     GUESSINGROWS=MAX;
RUN;
	

PROC SQL;
	CREATE TABLE JMS_QB_SALES AS SELECT
	VAR1
	,TYPE 
	,DATE 
	,NUM 
	,MEMO 
	,NAME 
	,ITEM 
	,QTY 
	,SALES_PRICE 
	,AMOUNT 
	,BALANCE

	FROM JMS_SALES_2019
	WHERE TYPE IS NOT NULL
	
	UNION
	
	SELECT 
	VAR1
	,TYPE 
	,DATE 
	,NUM 
	,MEMO 
	,NAME 
	,ITEM 
	,QTY 
	,SALES_PRICE 
	,INPUT(AMOUNT, BEST12.) 
	,BALANCE

	FROM JMS_SALES_2020
	WHERE TYPE IS NOT NULL
	
	;QUIT;


/* Group dates into months and perform initital cleaning/transformation */

PROC SQL;
	CREATE TABLE JMS_TRANS_2019_2020 AS SELECT
	TYPE
	,CASE WHEN DATE LIKE ('%2019%') THEN '2019'
		WHEN DATE LIKE ('%2020%') THEN '2020'
		ELSE 'OTHER' END AS YEAR
	,CASE WHEN DATE LIKE ('01%') AND DATE LIKE '%2019' THEN 01012019
	WHEN DATE LIKE ('02%') AND DATE LIKE '%2019' THEN 02022019
	WHEN DATE LIKE ('03%') AND DATE LIKE '%2019' THEN 03032019
	WHEN DATE LIKE ('04%') AND DATE LIKE '%2019' THEN 04042019
	WHEN DATE LIKE ('05%') AND DATE LIKE '%2019' THEN 05052019
	WHEN DATE LIKE ('06%') AND DATE LIKE '%2019' THEN 06062019
	WHEN DATE LIKE ('07%') AND DATE LIKE '%2019' THEN 07072019
	WHEN DATE LIKE ('08%') AND DATE LIKE '%2019' THEN 08082019
	WHEN DATE LIKE ('09%') AND DATE LIKE '%2019' THEN 09092019
	WHEN DATE LIKE ('10%') AND DATE LIKE '%2019' THEN 10102019
	WHEN DATE LIKE ('11%') AND DATE LIKE '%2019' THEN 11112019
	WHEN DATE LIKE ('12%') AND DATE LIKE '%2019' THEN 12122019
	WHEN DATE LIKE ('01%') AND DATE LIKE '%2020' THEN 13012020
	WHEN DATE LIKE ('02%') AND DATE LIKE '%2020' THEN 14022020
	WHEN DATE LIKE ('03%') AND DATE LIKE '%2020' THEN 15032020
	WHEN DATE LIKE ('04%') AND DATE LIKE '%2020' THEN 16042020
	WHEN DATE LIKE ('05%') AND DATE LIKE '%2020' THEN 17052020
	WHEN DATE LIKE ('06%') AND DATE LIKE '%2020' THEN 18062020
	WHEN DATE LIKE ('07%') AND DATE LIKE '%2020' THEN 19072020
	WHEN DATE LIKE ('08%') AND DATE LIKE '%2020' THEN 20082020
	WHEN DATE LIKE ('09%') AND DATE LIKE '%2020' THEN 21092020
	WHEN DATE LIKE ('10%') AND DATE LIKE '%2020' THEN 21102020
	WHEN DATE LIKE ('11%') AND DATE LIKE '%2020' THEN 23112020
	WHEN DATE LIKE ('12%') AND DATE LIKE '%2020' THEN 24122020
		ELSE 0 END AS MONTH_YEAR
	,DATE
	,NUM
	,UPCASE(MEMO) AS PROD_DESC
	,CASE WHEN UPCASE(NAME) LIKE ('JMSPRODUCTSUSA WEBSITE') THEN 'RETAIL'
	WHEN UPCASE(NAME) LIKE ('AMAZON.COM') THEN 'RETAIL'
	WHEN UPCASE(NAME) LIKE ('EBAY - WORLDWIDE') THEN 'RETAIL'
	WHEN UPCASE(NAME) LIKE ('ETSY SALES') THEN 'RETAIL'
		ELSE 'WHOLESALE' END AS CHANNEL
	,UPCASE (NAME) AS CUST_NAME
	,UPCASE (ITEM) AS ITEM_CODE
	,INPUT(QTY, BEST.) AS QTY
	,INPUT(SALES_PRICE, BEST.) AS SALES_PRICE
	,AMOUNT AS ITEM_TOTAL
	,INPUT(BALANCE, BEST.) AS CUM_TOTAL
	
	FROM JMS_QB_SALES
	
	WHERE TYPE IS NOT NULL
	
	;QUIT;
	
	
/* 	CREATE TABLE THAT IS ORDERS ONLY */
	
PROC SQL;
	CREATE TABLE ORDERS_ONLY AS SELECT
	*
	FROM JMS_TRANS_2019_2020
	WHERE ITEM_CODE NOT LIKE ('%FREIGHT%')
		AND PROD_DESC NOT LIKE ('%DROP SHIP%')
		
	;QUIT;


PROC SQL;
	CREATE TABLE WHOLESALE_BY_MONTH AS SELECT
	MONTH_YEAR
	,CHANNEL
	,COUNT(DISTINCT NUM) AS TOTAL_ORDERS
	,SUM(ITEM_TOTAL) AS SALES_TOTAL
	
	FROM ORDERS_ONLY
	
	WHERE CHANNEL IN ('WHOLESALE')
	
	GROUP BY 1,2
	ORDER BY 1
	
	;QUIT;
	
	
/* REVIEW MONTHLY SALES BY CHANNEL */
	
PROC SQL;
	CREATE TABLE RETAIL_BY_MONTH AS SELECT
	MONTH_YEAR
	,CHANNEL
	,COUNT(DISTINCT NUM) AS TOTAL_ORDERS
	,SUM(ITEM_TOTAL) AS SALES_TOTAL
	
	FROM ORDERS_ONLY
	
	WHERE CHANNEL IN ('RETAIL')
	
	GROUP BY 1,2
	ORDER BY 1
	
	;QUIT;


/* PROC EXPORT DATA=WORK.ORDERS_ONLY */
/* OUTFILE='/folders/myfolders/sasuser.v94/JMS Analysis/ORDERS_ONLY.csv' */
/* DBMS=CSV */
/* REPLACE; */
/* RUN; */


PROC SQL;
	CREATE TABLE REVIEW_ORDERS AS SELECT
	*
	FROM ORDERS_ONLY
	WHERE NUM IN ('15875')
	
	;QUIT;
	
PROC SQL;
	CREATE TABLE ORDER_TOTALS_FROM_INV AS SELECT
	CHANNEL
	,SUM(ITEM_TOTAL)
	FROM ORDERS_ONLY
	GROUP BY 1
	;QUIT;
	
	
/* CREATE BASE FOR TRANSACTION DATASET AND TRANSPOSE DATA*/

PROC SQL;
	CREATE TABLE JMS_TRANS AS SELECT
	NUM
	,ITEM_CODE
	,CHANNEL
	,CASE WHEN ITEM_CODE IS NOT NULL THEN 1 ELSE 0
		END AS ITEMS
	FROM ORDERS_ONLY
	WHERE TYPE IN ('Invoice')
	
	;QUIT;
	
PROC SQL;
	CREATE TABLE JMS_TRANS1 AS SELECT
	DISTINCT ITEM_CODE
	,NUM
	,ITEMS
	FROM JMS_TRANS
	;QUIT;
	
	
PROC SORT DATA=JMS_TRANS1 OUT=SORTED_JMS_TRANS;
	BY NUM ITEM_CODE;
	RUN;
	
PROC TRANSPOSE DATA=SORTED_JMS_TRANS OUT=TRANSACTION_DATA_JMS;
	BY NUM;
	ID ITEM_CODE;
/* 	VAR ITEMS; */
	RUN;
	
/* PROC EXPORT DATA=WORK.JMS_TRANS */
/* OUTFILE='/folders/myfolders/sasuser.v94/JMS Analysis/JMSTRANS2.csv' */
/* DBMS=CSV */
/* REPLACE; */
/* RUN; */

PROC SQL;
	CREATE TABLE JMS_TRANS_WS AS SELECT
	DISTINCT ITEM_CODE
	,NUM
	,ITEMS
	FROM JMS_TRANS
	WHERE CHANNEL IN ('WHOLESALE')
	;QUIT;
	
	
PROC SORT DATA=JMS_TRANS_WS OUT=SORTED_JMS_TRANS_WS;
	BY NUM ITEM_CODE;
	RUN;
	
PROC TRANSPOSE DATA=SORTED_JMS_TRANS_WS OUT=WS_TRANS_DATA_JMS;
	BY NUM;
	ID ITEM_CODE;
/* 	VAR ITEMS; */
	RUN;
	
/* PROC EXPORT DATA=WORK.WS_TRANS_DATA_JMS */
/* OUTFILE='/folders/myfolders/sasuser.v94/JMS Analysis/JMS_WS_TRANS.csv' */
/* DBMS=CSV */
/* REPLACE; */
/* RUN; */


PROC SQL;
	CREATE TABLE JMS_TRANS_RET AS SELECT
	DISTINCT ITEM_CODE
	,NUM
	,ITEMS
	FROM JMS_TRANS
	WHERE CHANNEL IN ('RETAIL')
	;QUIT;
	
	
PROC SORT DATA=JMS_TRANS_RET OUT=SORTED_JMS_TRANS_RET;
	BY NUM ITEM_CODE;
	RUN;
	
PROC TRANSPOSE DATA=SORTED_JMS_TRANS_RET OUT=RET_TRANS_DATA_JMS;
	BY NUM;
	ID ITEM_CODE;
/* 	VAR ITEMS; */
	RUN;
	
PROC EXPORT DATA=WORK.RET_TRANS_DATA_JMS
OUTFILE='/folders/myfolders/sasuser.v94/JMS Analysis/JMS_RET_TRANS.csv'
DBMS=CSV
REPLACE;
RUN;

