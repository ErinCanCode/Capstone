/* IMPORT AND CLEAN SHIPPING DATA */

PROC IMPORT OUT= WORK.JMS_SHIPPING_2019_2021 DATAFILE= "/folders/myfolders/sasuser.v94/JMS Analysis/2019 - 2021 JMS Shipping.csv" 
            DBMS=csv REPLACE;
     GETNAMES=YES;
RUN;

/* REVIEW DATASET VARIABLES */

PROC DATASETS;
	CONTENTS DATA = JMS_SHIPPING_2019_2021;
RUN;
	
/* GET PRELIMINARY COUNTS AND TOTALS FOR EACH STORE	 */
	
PROC SQL;
	CREATE TABLE WHERE_from AS SELECT
	DISTINCT STORE
	,COUNT(DISTINCT ORDER_NUMBER) AS TOTAL_ORDERS
	,SUM(ORDER_TOTAL) AS TOTAL_SALES
	
	FROM JMS_SHIPPING_2019_2021
	
	GROUP BY 1
	
	;QUIT;
	
/* Review characteristics of orders that are not related to JMS Sales */

PROC SQL;
	CREATE TABLE NON_SHEEPSKIN_ORDERS AS SELECT
	DISTINCT ITEM_NAME
	,ORDER_NUMBER
	FROM WORK.JMS_SHIPPING_2019_2021
	WHERE ITEM_NAME NOT LIKE ('%SHEEPSKIN%')
	and ITEM_NAME NOT LIKE ('%Sheepskin%')
	and ITEM_NAME NOT LIKE ('%sheepskin%')
	and ITEM_NAME NOT LIKE ('%Noseband%')
	and ITEM_NAME NOT LIKE ('%Pelt%')
	and ITEM_NAME NOT LIKE ('%Piece%')
	and ITEM_NAME NOT LIKE ('%Hide%')
	and ITEM_NAME NOT LIKE ('%CUSTOM%')
	AND ORDER_NUMBER NOT LIKE ('%JMS%')
		
	;QUIT;


/* Create table of orders that are JMS only	 */
PROC SQL;
	CREATE TABLE SHEEPSKIN_ORDERS AS SELECT
	*
	FROM WORK.JMS_SHIPPING_2019_2021
	WHERE ITEM_NAME LIKE ('%SHEEPSKIN%')
	OR ITEM_NAME LIKE ('%Sheepskin%')
	OR ITEM_NAME LIKE ('%sheepskin%')
	OR ITEM_NAME LIKE ('%Noseband%')
	OR ITEM_NAME LIKE ('%Pelt%')
	OR ITEM_NAME LIKE ('%Piece%')
	OR ITEM_NAME LIKE ('%Hide%')
/* 	OR ITEM_NAME LIKE ('%CUSTOM%') */
	OR ORDER_NUMBER LIKE ('%JMS%')
		
	;QUIT;
	
	
/* Verify effectiveness of cleaning */
PROC SQL;
	CREATE TABLE WHATS_LEFT AS SELECT
	DISTINCT ITEM_NAME
	,ORDER_NUMBER
	FROM WORK.JMS_SHIPPING_2019_2021
	WHERE ORDER_NUMBER NOT IN (SELECT ORDER_NUMBER FROM SHEEPSKIN_ORDERS) 
	
	;QUIT;
	
	
/* Export cleaned data */
	
/* LIBNAME JMS "/folders/myfolders/sasuser.v94/JMS Analysis"; */
/* RUN; */

/* PROC EXPORT DATA=WORK.SHEEPSKIN_ORDERS */
/* OUTFILE='/folders/myfolders/sasuser.v94/JMS Analysis/SHIPPING_DATA_CLEANED.csv' */
/* DBMS=CSV */
/* REPLACE; */
/* RUN; */
	
	
PROC SQL;
	CREATE TABLE OVERSEAS_ORDERS AS SELECT
	*
	FROM SHEEPSKIN_ORDERS

	WHERE DESTINATION_COUNTRY NOT IN ('United States')
	
	;QUIT;
	
PROC SQL;
	CREATE TABLE US_SHEEPSKIN_ORDERS AS SELECT
	*
	FROM SHEEPSKIN_ORDERS
	WHERE DESTINATION_COUNTRY IN ('United States')
	;QUIT;
	
	
/* PROC EXPORT DATA=WORK.US_SHEEPSKIN_ORDERS */
/* OUTFILE='/folders/myfolders/sasuser.v94/JMS Analysis/US_SHIPPING_DATA.csv' */
/* DBMS=CSV */
/* REPLACE; */
/* RUN; */


/* Review names of items shipped to explore cleaning options	 */

PROC SQL;
	CREATE TABLE SHIPPING_ITEM_NAMES AS SELECT
	DISTINCT (ITEM_NAME)
	,COUNT (DISTINCT ORDER_NUMBER) AS ORDERS
	
	FROM US_SHEEPSKIN_ORDERS
	
	WHERE ITEM_NAME not LIKE ('%Strap Pad%')
	and ITEM_NAME NOT LIKE ('%ARM REST%')
	and ITEM_NAME NOT LIKE ('%Arm Rest%')
	
	GROUP BY 1
	ORDER BY 2 DESC
	
	;QUIT;


/* Designate flag to denote wholesale vs retail shipments */

PROC SQL;
	CREATE TABLE US_SHEEP_ORD_W_FLAG AS SELECT
	* 
	,CASE WHEN STORE LIKE ('Manual Orders') THEN 1 ELSE 0
	END AS WHOLESALE
	FROM US_SHEEPSKIN_ORDERS
	
	;QUIT;
	
	
PROC SQL;
	CREATE TABLE MANUAL_VS_WEB AS SELECT
	*
	FROM US_SHEEPSKIN_ORDERS
	WHERE STORE IN ('Manual Orders', 'Just Merino Sheepskin')
	;quit;
	
PROC SQL;
	CREATE TABLE WHOLESALE_TOTALS AS SELECT
	WHOLESALE
	,SUM(ORDER_TOTAL) AS TOTAL_SALES
	
	FROM US_SHEEP_ORD_W_FLAG
	GROUP BY 1
	;QUIT;
	



